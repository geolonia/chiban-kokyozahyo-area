<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deploy Preview - Geolonia Map</title>
  <style>
    html,
    body,
    #map {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>

  <div id="map" class="left" data-zoom="5" data-lat="37.01" data-lng="138.09" data-hash="on" data-marker="off"></div>

  <script src="https://cdn.geolonia.com/v1/embed?geolonia-api-key=YOUR-API-KEY"></script>
  <script>
    const map = new geolonia.Map({
      container: "#map",
      style: "geolonia/gsi"
    });

    map.on('load', () => {

      map.addSource('outside-area', {
        type: 'vector',
        url: 'https://tileserver.geolonia.com/outside_area_files3/tiles.json?key=YOUR-API-KEY'
      });

      map.addSource('chiban-cities', {
        type: 'vector',
        url: 'https://tileserver.geolonia.com/chiban-cities/tiles.json?key=YOUR-API-KEY'
      })

      // map.addLayer({
      //   id: 'admins/polygon',
      //   type: 'fill',
      //   source: 'chiban-cities',
      //   'source-layer': 'admins',
      //   paint: {
      //     'fill-color': '#ffffff',
      //     'fill-opacity': 0.5,
      //   }
      // });

      // popupでクリックした地点のデータを表示する
      map.on('click', 'outside-area/polygonFill', (e) => {
        const popup = new geolonia.Popup()
          .setLngLat(e.lngLat)
          .setHTML(JSON.stringify(e.features[0].properties))
          .addTo(map);
      });

      map.addLayer({
        id: 'outside-area/pointHeatmap',
        type: 'heatmap',
        source: 'outside-area',
        'source-layer': 'outside-area',
        maxzoom: 12,
        filter: ["==", "$type", "Point"],
        paint: {
          // Increase the heatmap weight based on frequency and property magnitude
          'heatmap-weight': [
            'interpolate',
            ['linear'],
            ['get', 'sqrt_point_count'],
            0,
            0,
            100,
            1
          ],
          // Increase the heatmap color weight weight by zoom level
          // heatmap-intensity is a multiplier on top of heatmap-weight
          'heatmap-intensity': [
            'interpolate',
            ['linear'],
            ['zoom'],
            0,
            1,
            9,
            3
          ],
          // Color ramp for heatmap.  Domain is 0 (low) to 1 (high).
          // Begin color ramp at 0-stop with a 0-transparancy color
          // to create a blur-like effect.
          'heatmap-color': [
            'interpolate',
            ['linear'],
            ['heatmap-density'],
            0,
            'rgba(33,102,172,0)',
            0.2,
            'rgb(103,169,207)',
            0.4,
            'rgb(209,229,240)',
            0.6,
            'rgb(253,219,199)',
            0.8,
            'rgb(239,138,98)',
            1,
            'rgb(178,24,43)'
          ],
          // Adjust the heatmap radius by zoom level
          'heatmap-radius': [
            'interpolate',
            ['linear'],
            ['get', 'point_count'],
            0,
            2,
            100,
            30
          ],
        }
      });

      map.addLayer({
        id: 'outside-area/polygonFill',
        type: 'fill',
        source: 'outside-area',
        'source-layer': 'outside-area',
        minzoom: 12,
        filter: ["==", "$type", "Polygon"],
        paint: {
          'fill-color': '#0000ff',
          'fill-opacity': 0.2,
        }
      });

      map.addLayer({
        id: 'outside-area/polygonBorder',
        type: 'line',
        source: 'outside-area',
        'source-layer': 'outside-area',
        minzoom: 12,
        filter: ["==", "$type", "Polygon"],
        paint: {
          'line-color': '#0000ff',
          'line-opacity': 0.2,
        }
      });

      // map.addLayer({
      //   id: 'outside-area/polygonName',
      //   type: 'symbol',
      //   source: 'outside-area',
      //   'source-layer': 'outside-area',
      //   minzoom: 12,
      //   filter: ["==", "$type", "Polygon"],
      //   paint: {
      //     'text-color': '#ffffff'
      //   },
      //   layout: {
      //     'text-field': '{地番}',
      //     'text-font': ['Noto Sans Regular'],
      //     'text-size': [
      //       'interpolate',
      //       ['linear'],
      //       ['zoom'],
      //       16,
      //       10,
      //       19,
      //       16,
      //     ]
      //   }
      // })

      map.addLayer({
        id: 'admins/line-gap',
        type: 'line',
        source: 'chiban-cities',
        'source-layer': 'admins',
        minzoom: 12,
        paint: {
          'line-color': '#ffffff',
          'line-width': 5,
        }
      });

      map.addLayer({
        id: 'admins/line',
        type: 'line',
        source: 'chiban-cities',
        'source-layer': 'admins',
        minzoom: 12,
        paint: {
          'line-color': '#ff0000',
          'line-width': 3,
          // 'line-dasharray': [5, 5],
        }
      });
    })
  </script>
</body>

</html>