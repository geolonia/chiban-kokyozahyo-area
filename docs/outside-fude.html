<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>法務省登記所備付地図データ 公共座標の筆かつ所属する市区町村外の座標を可視化</title>
  <link rel="stylesheet" href="./style.css">
</head>

<body>
  <div id="map" class="left" data-zoom="5" data-lat="37.01" data-lng="138.09" data-hash="on" data-marker="off"></div>
  <div class="map-overlay-container">
    <div class="map-overlay top">
      <div class="map-overlay-inner">
        <h2>登記所備付地図データ| 座標が壊れている筆を可視化</h2>
        <label id="year">市区町村外の筆の面積の割合</label>
        <input id="slider" type="range" min="0" max="100" step="1" value="0">
        <div class="legend-container">
          <div id="legend-number">
            <div>0%</div>
            <div>50%</div>
            <div>100%</div>
          </div>
        </div>
        <!-- <a class="attribution" href="https://www.city.osaka.lg.jp/contents/wdu290/opendata/#cat-all_data-00000382">
          <p>「食品営業許可施設一覧（令和3年12月31日現在）」（大阪市）を加工して作成</p>
        </a> -->
      </div>
    </div>
  </div>
  <script src="https://cdn.geolonia.com/v1/embed?geolonia-api-key=YOUR-API-KEY"></script>
  <script>
    const map = new geolonia.Map({
      container: "#map",
      style: "./style.json"
    });

    map.on('load', () => {

      // popupでクリックした地点のデータを表示する
      map.on('click', 'outside-area/polygonFill', (e) => {

        // table でプロパティを表示する
        const properties = e.features[0].properties;

        let tableHTML = '';
        for (const key in properties) {
          let label = key;
          let value = properties[key];

          if (label === 'outside_area_rate') {
            label = '筆の市区町村外の面積の割合'
            value = `${value * 100}%`
          }

          if (label === 'zip_file') {
            label = 'zipファイル名'
            value = `${value}.zip`
          }

          tableHTML += `<tr><th>${label}</th><td>${value}</td></tr>`;
        }

        const popup = new geolonia.Popup()
          .setLngLat(e.lngLat)
          .setHTML(`<table>${tableHTML}</table>`)
          .setMaxWidth("300px")
          .addTo(map);
      });

    })
  </script>
</body>

</html>